<div class="tabla-container">

  <!-- Tabla con Angular Material -->
  <table mat-table [dataSource]="datos" class="mat-elevation-z8">

    <!-- Columnas dinámicas -->
    <ng-container *ngFor="let columna of columnasVisibles" [matColumnDef]="columna">
      <th mat-header-cell *matHeaderCellDef>{{ nombresColumnas[columna] }}</th>
      <td mat-cell *matCellDef="let elemento">
        <ng-container *ngIf="columna !== 'acciones'; else accionesTemplate">
          <!-- Mostrar categoría correctamente -->
          <span *ngIf="columna === 'categoria'">
            {{ elemento[columna]?.descripcion || 'Sin categoría' }}
          </span>
          <!-- Mostrar cliente correctamente -->
          <span *ngIf="columna === 'cliente'">
            {{ elemento[columna]?.nombre || 'Sin cliente' }}
          </span>
          <!-- Mostrar vendedor correctamente -->
          <span *ngIf="columna === 'vendedor'">
            {{ elemento[columna]?.nombre || 'Sin vendedor' }}
          </span>
          <!-- Mostrar fecha formateada -->
          <span *ngIf="columna === 'fecha'">
            {{ elemento[columna] | date:'shortDate' }}
          </span>
          <!-- Mostrar total formateado -->
          <span *ngIf="columna === 'total'">
            {{ elemento[columna] | currency:'USD':'symbol':'1.2-2' }}
          </span>
          <!-- Mostrar estado activo/inactivo -->
          <span *ngIf="columna === 'activo'" [class]="elemento[columna] ? 'status-active' : 'status-inactive'">
            {{ elemento[columna] ? 'Activo' : 'Inactivo' }}
          </span>
          <!-- Mostrar campos normales -->
          <span *ngIf="columna !== 'categoria' && columna !== 'cliente' && columna !== 'vendedor' && columna !== 'fecha' && columna !== 'total' && columna !== 'activo'">
            {{ elemento[columna] }}
          </span>
        </ng-container>
        <ng-template #accionesTemplate>
          <div class="acciones-cell">
            <app-acciones 
              [fila]="elemento" 
              [mostrarEditar]="true" 
              [mostrarEliminar]="true"
              [mostrarVer]="false"
              [mostrarCustom]="false"
              (accion)="accionFila($event)">
            </app-acciones>
          </div>
        </ng-template>
      </td>
    </ng-container>


    <!-- Filas de encabezado y datos -->
    <tr mat-header-row *matHeaderRowDef="columnasVisibles"></tr>
    <tr mat-row *matRowDef="let row; columns: columnasVisibles;"></tr>

  </table>

  <!-- Paginador -->
  <mat-paginator
    [length]="totalRegistros"
    [pageSize]="tamanioPagina"
    [pageIndex]="paginaActual"
    [pageSizeOptions]="[5,10,20,50]"
    showFirstLastButtons
    (page)="paginaCambiada($event)">
  </mat-paginator>

  <!-- Spinner de carga -->
  <div class="spinner-container" *ngIf="cargando">
    <mat-spinner></mat-spinner>
  </div>

</div>
